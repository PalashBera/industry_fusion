<% provide(:title, "Approved Indents") %>
<% provide(:page_title, "Approved Indents") %>

<%= render "shared/page_help" %>

<div class="card">
  <div class="card-body">
    <%= render partial: "procurement/indents/shared/status_tab", locals: { current_tab: "approved" } %>

    <section class="mb-4 d-flex justify-content-between">
      <h3 class="text-muted mt-2">Total Count: <%= @total_count %></h3>

      <div class="btn-group bulk-action-dropdown hide">
        <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Bulk Actions
        </button>
        <div class="dropdown-menu dropdown-menu-right">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <a class="dropdown-item" href="#">Something else here</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Separated link</a>
        </div>
      </div>
    </section>

    <% if @indent_items.present? %>
      <%= render "index_table" %>
    <% else %>
      <div class="card">
        <div class="card-body text-center">
          <% if params[:q].present? %>
            No result found. Please search with proper keywords.
          <% else %>
            No indent has been added yet. <%= new_link("pending_indents") %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<div id="note_modal_block"></div>

<div id="auto_next_link">
  <%= render "shared/auto_incremental_pagy" %>
</div>

<script>
  var loadNextPage = function () {
    if ($('#records_table').height() === undefined || $('#next_link').data("loading")) { return }  // prevent multiple loading
    var wBottom = $(window).scrollTop() + $(window).height();
    var elBottom = $('#records_table').offset().top + $('#records_table').height();

    if (wBottom > elBottom) {
      if ($('#next_link')[0] !== undefined) {    // checking next page link is available or not
        $('#next_link')[0].click();
        $('#next_link').data("loading", true);
      }
    }
  };

  window.addEventListener('resize', loadNextPage);
  window.addEventListener('scroll', loadNextPage);
  window.addEventListener('load', loadNextPage);
</script>
